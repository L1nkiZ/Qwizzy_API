name: "Lint, Typecheck and Formatting"

on:
    pull_request:
        types: [opened, edited, synchronize, reopened]

jobs:
    lint:
        name: Lint
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Use Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'
            - name: Cache node modules
              uses: actions/cache@v4
              with:
                    path: ~/.npm
                    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}
                    restore-keys: |
                        ${{ runner.os }}-node-

            - name: Install dependencies
              run: npm ci

            - name: Run linter
              run: npm run lint
              env:
                    CI: true

    typecheck:
        name: Typecheck
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Use Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'

            - name: Cache node modules
              uses: actions/cache@v4
              with:
                    path: ~/.npm
                    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}
                    restore-keys: |
                        ${{ runner.os }}-node-

            - name: Install dependencies
              run: npm ci

            - name: Run typecheck
              run: npm run typecheck
              env:
                    CI: true

    formatting:
        name: Formatting (check)
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Use Node.js
              uses: actions/setup-node@v4
              with:
                node-version: '18'

            - name: Cache node modules
              uses: actions/cache@v4
              with:
                    path: ~/.npm
                    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}
                    restore-keys: |
                        ${{ runner.os }}-node-

            - name: Install dependencies
              run: npm ci

            - name: Check formatting
              run: npm run format:check
              env:
                    CI: true